{% extends 'base.html' %}
{% block title %}SafeWalk{% endblock %}
{% block head %}
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/flipclock.css">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

{% endblock %}
{% block content %}
<div style="text-align: center"> <h2>Your Local Time: &nbsp <div id='clock'></div></h2></div>
<h1>SafeWalk Safety Alert Sets</h1>


<h2>Recurring Alerts*</h2>
{% for set in alert_sets %}
{% if set.interval %}
<h5>{{ set.a_name }} 
	<input id="toggle{{ set.alert_set_id }}" type="checkbox" data-toggle="toggle" data-on="Alert Set Active" data-off="Inactive" {% if set.active == True %}checked{% endif %}>

	{% if set.active == True %}
	{{ set.next_alarm_dis }}
	{{ set.countdown }}
	<div id='countdown{{ set.alert_set_id }}'></div>
	<script type="text/javascript">
	$(document).ready( function() {

	  function count{{ set.alert_set_id }}() {
	    var days = {{ set.days }};
	    var hours = {{ set.hours }};
	    var minutes = {{ set.minutes }};

	    var seconds = {{ set.seconds }};


	    if (seconds < 10) {
	    // Add the "0" digit to the front
	    // so 9 becomes "09"
	    seconds = "0" + seconds;
		}

		if (minutes < 10) {
	    // Add the "0" digit to the front
	    // so 9 becomes "09"
	    minutes = "0" + minutes;
		}

	    // This gets a "handle" to the clock div in our HTML
	    var countDiv = document.getElementById('countdown{{ set.alert_set_id }}');

	    // Then we set the text inside the clock div 
	    // to the hours, minutes, and seconds of the current time
	    countDiv.innerText = days + " days and " + hours + ":" + minutes + ":" + seconds;
	  }

	  // This runs the displayTime function the first time
	  count{{ set.alert_set_id }}();
	  setInterval(count{{ set.alert_set_id }}, 1000);

	});
</script>
{% endif %}
</h5>
<script>
	$(document).ready(function(){
	    $( "#toggle{{ set.alert_set_id }}" ).change(function(event){
	        if(this.checked) {
	        	$.get("/activate/{{ set.alert_set_id }}");
	        	console.log("Toggle Button On is working");
	        }
	       	else {
	       		$.get("/deactivate/{{ set.alert_set_id }}");
	        	console.log("Toggle Button Off is working");
	        }
	    });
	    
	});
</script>
{% endif %}
{% endfor %}
<form method="GET" action="/rec_alerts">
    <button type="submit">Add New Recurring Alert Set</button>
</form><br><br><br>

<h2>Pre-set/Scheduled Alerts*</h2>
{% for set in alert_sets %}
{% if not set.interval %}
<h5><a href="/edit_schedset/{{ set.alert_set_id }}">{{ set.a_name }}</a> &nbsp &nbsp 
	<input id="toggle{{ set.alert_set_id }}" type="checkbox" data-toggle="toggle" data-on="Alert Set Active" data-off="Inactive" {% if set.active == True %}checked{% endif %}>
</h5>
<script>
	$(document).ready(function(){
	    $( "#toggle{{ set.alert_set_id }}" ).change(function(event){
	        if(this.checked) {
	        	$.get("/activate/{{ set.alert_set_id }}");
	        	console.log("Toggle Button On is working");
	        }
	       	else {
	       		$.get("/deactivate/{{ set.alert_set_id }}");
	        	console.log("Toggle Button Off is working");
	        }
	    });
	    
	});
</script>
{% endif %}
{% endfor %}
<form method="GET" action="/sched_alerts">
    <button type="submit">Add New Scheduled Alert Set</button>
</form>

<br><br><br>
	<b>*Adding an Alert Set: Do you want your alert set to require recurring check-ins (by a certain time interval) or pre-set check-ins with scheduled pre-set times?</b> Recurring check-ins are best if you aren't sure of your schedule when you go out to work (like with most who work the street). Pre-set check-ins are best if you have a known schedule and/or date with a client. In that case, you can require check-ins shortly after arriving, when the date should end, and/or some period after that (in case you aren't sure of the end time).<br>


<script>
	$(document).ready(function(){
	    $( "#title_but" ).click(function(){
	        console.log("Toggle Button is working");
	    });
	});
</script>
<script type="text/javascript">
	$(document).ready( function() {

	  function displayTime() {
	    var currentTime = new Date();
		var year = currentTime.getYear() + 1900
	    var month = currentTime.getMonth()
	    var day = currentTime.getDate()
	    var hours = currentTime.getUTCHours();
	    var minutes = currentTime.getMinutes();
	    var seconds = currentTime.getSeconds();
	    var meridiem = "AM";
	    hours = hours + {{ timezone }}
	    if (hours < 1) {
	    	hours = 25 + hours
	    }
	    if (hours > 12) {
		    hours = hours - 12;
		    meridiem = "PM";
		}

		// 0 AM and 0 PM should read as 12
		if (hours === 0) {
		    hours = 12;    
		}

	    if (seconds < 10) {
	    // Add the "0" digit to the front
	    // so 9 becomes "09"
	    seconds = "0" + seconds;
		}

		if (minutes < 10) {
	    // Add the "0" digit to the front
	    // so 9 becomes "09"
	    minutes = "0" + minutes;
		}

	    // This gets a "handle" to the clock div in our HTML
	    var clockDiv = document.getElementById('clock');

	    // Then we set the text inside the clock div 
	    // to the hours, minutes, and seconds of the current time
	    clockDiv.innerText =  hours + ":" + minutes + ":" + seconds + " " + meridiem + ",    " + month + "/" + day + "/" + year;
	  }

	  // This runs the displayTime function the first time
	  displayTime();
	  setInterval(displayTime, 1000);

	});
</script>
{% endblock %}